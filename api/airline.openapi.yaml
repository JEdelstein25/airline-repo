# yaml-language-server: $schema=https://spec.openapis.org/oas/3.0/schema/2024-10-18
openapi: 3.0.0
info:
  title: Stellora Airline API
  version: 1.0.0
paths:
  /health:
    get:
      operationId: healthCheck
      summary: Health check endpoint
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
  /aircraft:
    get:
      operationId: listAircraft
      summary: List all aircraft
      responses:
        '200':
          description: List of aircraft
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Aircraft'
    post:
      operationId: createAircraft
      summary: Create a new aircraft
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                registration:
                  $ref: '#/components/schemas/AircraftRegistration'
                aircraftType:
                  $ref: '#/components/schemas/AircraftTypeICAOCode'
                airline:
                  $ref: '#/components/schemas/AirlineSpec'
              required:
                - registration
                - aircraftType
                - airline
      responses:
        '201':
          description: Aircraft created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Aircraft'
        '400':
          description: Invalid request
    delete:
      operationId: deleteAllAircraft
      summary: Delete all aircraft
      responses:
        '204':
          description: All aircraft deleted
  /aircraft/{aircraftSpec}:
    get:
      operationId: getAircraft
      summary: Get aircraft by ID or registration
      parameters:
        - $ref: '#/components/parameters/aircraftSpec'
      responses:
        '200':
          description: Aircraft found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Aircraft'
        '404':
          description: Aircraft not found
    patch:
      operationId: updateAircraft
      summary: Update aircraft
      parameters:
        - $ref: '#/components/parameters/aircraftSpec'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                registration:
                  $ref: '#/components/schemas/AircraftRegistration'
                aircraftType:
                  $ref: '#/components/schemas/AircraftTypeICAOCode'                
                airline:
                  $ref: '#/components/schemas/AirlineSpec'
      responses:
        '200':
          description: Aircraft updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Aircraft'
        '404':
          description: Aircraft not found
    delete:
      operationId: deleteAircraft
      summary: Delete an aircraft
      parameters:
        - $ref: '#/components/parameters/aircraftSpec'
      responses:
        '204':
          description: Aircraft deleted
        '404':
          description: Aircraft not found
  /airlines/{airlineSpec}/aircraft:
    get:
      operationId: listAircraftByAirline
      summary: List all aircraft owned by an airline
      parameters:
        - $ref: '#/components/parameters/airlineSpec'
      responses:
        '200':
          description: List of aircraft
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Aircraft'
        '404':
          description: Airline not found
  /aircraft-types:
    get:
      operationId: listAircraftTypes
      summary: List all aircraft types
      responses:
        '200':
          description: List of aircraft types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AircraftType'
  /airports:
    get:
      operationId: listAirports
      summary: List all airports
      responses:
        '200':
          description: List of airports
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Airport'
    post:
      operationId: createAirport
      summary: Create a new airport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                iataCode:
                  $ref: '#/components/schemas/AirportIATACode'
              required:
                - iataCode
      responses:
        '201':
          description: Airport created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Airport'
        '400':
          description: Invalid request
    delete:
      operationId: deleteAllAirports
      summary: Delete all airports
      responses:
        '204':
          description: All airports deleted
  /airports/{airportSpec}:
    get:
      operationId: getAirport
      summary: Get airport by ID or IATA code
      parameters:
        - $ref: '#/components/parameters/airportSpec'
      responses:
        '200':
          description: Airport found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Airport'
        '404':
          description: Airport not found
    patch:
      operationId: updateAirport
      summary: Update airport
      parameters:
        - $ref: '#/components/parameters/airportSpec'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                iataCode:
                  $ref: '#/components/schemas/AirportIATACode'                
      responses:
        '200':
          description: Airport updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Airport'
        '404':
          description: Airport not found
    delete:
      operationId: deleteAirport
      summary: Delete an airport
      parameters:
        - $ref: '#/components/parameters/airportSpec'
      responses:
        '204':
          description: Airport deleted
        '404':
          description: Airport not found
  /airports/{airportSpec}/flight-schedules:
    get:
      operationId: listFlightSchedulesByAirport
      summary: List flight schedules that depart from or arrive at an airport
      parameters:
        - $ref: '#/components/parameters/airportSpec'
      responses:
        '200':
          description: Flight schedules by airport
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FlightSchedule'
        '404':
          description: Airport not found
  /airlines:
    get:
      operationId: listAirlines
      summary: List all airlines
      responses:
        '200':
          description: List of airlines
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Airline'
    post:
      operationId: createAirline
      summary: Create a new airline
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                iataCode:
                  $ref: '#/components/schemas/AirlineIATACode'
                name:
                  type: string
              required:
                - iataCode
                - name
      responses:
        '201':
          description: Airline created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Airline'
        '400':
          description: Invalid request
    delete:
      operationId: deleteAllAirlines
      summary: Delete all airlines
      responses:
        '204':
          description: All airlines deleted
  /airlines/{airlineSpec}:
    get:
      operationId: getAirline
      summary: Get airline by ID or IATA code
      parameters:
        - $ref: '#/components/parameters/airlineSpec'
      responses:
        '200':
          description: Airline found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Airline'
        '404':
          description: Airline not found
    patch:
      operationId: updateAirline
      summary: Update airline
      parameters:
        - $ref: '#/components/parameters/airlineSpec'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                iataCode:
                  $ref: '#/components/schemas/AirlineIATACode'
                name:
                  type: string
      responses:
        '200':
          description: Airline updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Airline'
        '404':
          description: Airline not found
    delete:
      operationId: deleteAirline
      summary: Delete an airline
      parameters:
        - name: airlineSpec
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AirlineSpec'
      responses:
        '204':
          description: Airline deleted
        '404':
          description: Airline not found
  /airlines/{airlineSpec}/flight-schedules:
    get:
      operationId: listFlightSchedulesByAirline
      summary: List flight schedules for an airline
      parameters:
        - $ref: '#/components/parameters/airlineSpec'
      responses:
        '200':
          description: Flight schedules by airline
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FlightSchedule'
        '404':
          description: Airline not found
  /flight-schedules:
    get:
      operationId: listFlightSchedules
      summary: List all flight schedules
      responses:
        '200':
          description: List of flight schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FlightSchedule'
    post:
      operationId: createFlightSchedule
      summary: Create a new flight schedule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                airline:
                  $ref: '#/components/schemas/AirlineSpec'
                number:
                  $ref: '#/components/schemas/FlightNumber'
                originAirport:
                  $ref: '#/components/schemas/AirportSpec'
                destinationAirport:
                  $ref: '#/components/schemas/AirportSpec'
                aircraftType:
                  $ref: '#/components/schemas/AircraftTypeICAOCode'
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                daysOfWeek:
                  $ref: '#/components/schemas/DaysOfWeek'
                published:
                  type: boolean
                  default: false
              required:
                - airline
                - number
                - originAirport
                - destinationAirport
                - aircraftType
                - startDate
                - endDate
                - daysOfWeek
      responses:
        '201':
          description: Flight schedule created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightSchedule'
        '400':
          description: Invalid request
    delete:
      operationId: deleteAllFlightSchedules
      summary: Delete all flight schedules
      responses:
        '204':
          description: All flight schedules deleted
  /flight-schedules/{id}:
    get:
      operationId: getFlightSchedule
      summary: Get flight schedule by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Flight schedule found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightSchedule'
        '404':
          description: Flight schedule not found
    patch:
      operationId: updateFlightSchedule
      summary: Update flight schedule
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                airline:
                  $ref: '#/components/schemas/AirlineSpec'
                number:
                  $ref: '#/components/schemas/FlightNumber'
                originAirport:
                  $ref: '#/components/schemas/AirportSpec'
                destinationAirport:
                  $ref: '#/components/schemas/AirportSpec'
                aircraftType:
                  $ref: '#/components/schemas/AircraftTypeICAOCode'
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                daysOfWeek:
                  $ref: '#/components/schemas/DaysOfWeek'
                published:
                  type: boolean
      responses:
        '200':
          description: Flight schedule updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightSchedule'
        '404':
          description: Flight schedule not found
    delete:
      operationId: deleteFlightSchedule
      summary: Delete a flight schedule
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Flight schedule deleted
        '404':
          description: Flight schedule not found
  /flight-schedules/{id}/instances:
    get:
      operationId: listFlightInstancesForFlightSchedule
      summary: Get flight instances defined by a flight schedule
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of flight instances
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FlightInstance'
        '404':
          description: Flight schedule not found
  /flight-instances:
    get:
      operationId: listFlightInstances
      summary: List all flight instances
      responses:
        '200':
          description: List of flight instances
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FlightInstance'
  /flight-instances/{id}:
    get:
      operationId: getFlightInstance
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Flight instance found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightInstance'
        '404':
          description: Flight instance not found
    patch:
      operationId: updateFlightInstance
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                aircraft:
                  $ref: '#/components/schemas/AircraftSpec'
                notes:
                  type: string
      responses:
        '200':
          description: Flight instance updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightInstance'
        '404':
          description: Flight instance not found
  /routes:
    get:
      operationId: listRoutes
      summary: List all routes
      responses:
        '200':
          description: List of routes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Route'
  /routes/{route}:
    get:
      operationId: getRoute
      summary: Get route by IATA codes of origin and destination airports
      parameters:
        - name: route
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z]{3}-[A-Z]{3}$'
      responses:
        '200':
          description: Route information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Route'
        '404':
          description: Route not found
components:
  parameters:
    aircraftSpec:
      name: aircraftSpec
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/AircraftSpec'
    airportSpec:
      name: airportSpec
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/AirportSpec'
    airlineSpec:
      name: airlineSpec
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/AirlineSpec'
  schemas:
    AircraftID:
      type: integer
    AircraftRegistration:
      type: string
      description: Registration code for an aircraft. See https://en.wikipedia.org/wiki/List_of_aircraft_registration_prefixes.
      pattern: '^[A-Z][A-Z0-9-]{1,12}$'
      minLength: 2
      maxLength: 13
    AircraftSpec:
      oneOf:
        - $ref: '#/components/schemas/AircraftID'
        - $ref: '#/components/schemas/AircraftRegistration'
    Aircraft:
      type: object
      properties:
        id:
          type: integer
        registration:
          $ref: '#/components/schemas/AircraftRegistration'
        aircraftType:
          $ref: '#/components/schemas/AircraftTypeICAOCode'
        airline:
          $ref: '#/components/schemas/Airline'
      required:
        - id
        - registration
        - aircraftType
        - airline
    AircraftTypeICAOCode:
      type: string
      description: ICAO aircraft type code for an aircraft. See https://en.wikipedia.org/wiki/List_of_aircraft_type_designators.
      pattern: '^[A-Z][A-Z0-9]{1,3}$'
      minLength: 2
      maxLength: 4
    AircraftType:
      type: object
      properties:
        icaoCode:
          $ref: '#/components/schemas/AircraftTypeICAOCode'
        name:
          type: string
      required:
        - icaoCode
        - name
    AirlineID:
      type: integer
    AirlineIATACode:
      type: string
      description: IATA code for airline
      pattern: '^[A-Z]{2}$'
      minLength: 2
      maxLength: 2
    AirlineSpec:
      oneOf:
        - $ref: '#/components/schemas/AirlineID'
        - $ref: '#/components/schemas/AirlineIATACode'
    Airline:
      type: object
      properties:
        id:
          type: integer
        iataCode:
          $ref: '#/components/schemas/AirlineIATACode'
        name:
          type: string
      required:
        - id
        - iataCode
        - name
    AirportID:
      type: integer
    AirportIATACode:
      type: string
      description: IATA code for airport
      pattern: '^[A-Z]{3}$'
      minLength: 3
      maxLength: 3
    AirportSpec:
      oneOf:
        - $ref: '#/components/schemas/AirportID'
        - $ref: '#/components/schemas/AirportIATACode'
    Airport:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        iataCode:
          $ref: '#/components/schemas/AirportIATACode'
        country:
          type: string
        region:
          type: string        
        point:
          $ref: '#/components/schemas/Point'
      required:
        - id
        - name
        - iataCode
        - country
        - region
        - point
    Point:
      type: object
      properties:
        longitude:
          type: number
          format: double
        latitude:
          type: number
          format: double
      required:
        - longitude
        - latitude
    DaysOfWeek:
      type: array
      items:
        type: integer
        enum: [0, 1, 2, 3, 4, 5, 6]
        description: 0 = Sunday, 1 = Monday, ..., 6 = Saturday
      minItems: 0
      maxItems: 7
      uniqueItems: true
    FlightSchedule:
      type: object
      properties:
        id:
          type: integer
        airline:
          $ref: '#/components/schemas/Airline'
        number:
          $ref: '#/components/schemas/FlightNumber'
        originAirport:
          $ref: '#/components/schemas/Airport'
        destinationAirport:
          $ref: '#/components/schemas/Airport'
        distanceMiles:
          type: number
          format: double
        aircraftType:
          $ref: '#/components/schemas/AircraftType'
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        daysOfWeek:
          $ref: '#/components/schemas/DaysOfWeek'
        published:
          type: boolean
      required:
        - id
        - airline
        - number
        - originAirport
        - destinationAirport
        - aircraftType
        - startDate
        - endDate
        - daysOfWeek
        - published
    FlightNumber:
      type: string
      pattern: '^[0-9]{1,4}$'
      minLength: 1
      maxLength: 4
    FlightInstance:
      type: object
      description: A single flight, associated with the FlightSchedule template that defined it.
      properties:
        id:
          type: integer
        source:
          $ref: '#/components/schemas/FlightSchedule'
        instanceDate:
          type: string
          format: date
        aircraft:
          $ref: '#/components/schemas/Aircraft'
        notes:
          type: string
      required:
        - id
        - source
        - instanceDate
    Route:
      type: object
      properties:
        originAirport:
          $ref: '#/components/schemas/Airport'
        destinationAirport:
          $ref: '#/components/schemas/Airport'
        distanceMiles:
          type: number
          format: double
        flightSchedulesCount:
          type: integer
      required:
        - originAirport
        - destinationAirport
        - flightSchedulesCount
      